<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Study Planner Dashboard</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="stylesheet" href="style.css">
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<style>
body { margin:0; padding:0; font-family:'Poppins',sans-serif; min-height:100vh; text-align:center; background:url('images/home-bg.jpg') no-repeat center center/cover; color:#fff; }
h1 { margin-top:30px; font-size:3rem; text-shadow:2px 2px 15px rgba(0,0,0,0.8); }

.button-container { display:flex; justify-content:center; gap:40px; margin-top:50px; flex-wrap:wrap; }
.tile { width:180px; height:180px; border-radius:20px; display:flex; flex-direction:column; justify-content:center; align-items:center; font-weight:bold; font-size:1.2rem; cursor:pointer; text-align:center; color:#fff; box-shadow:0 0 20px rgba(0,0,0,0.5); transition: transform 0.3s, box-shadow 0.3s; position:relative; overflow:hidden; }
.tile i { font-size:2.2rem; margin-bottom:10px; }
.tile:hover { transform:translateY(-10px) scale(1.05); box-shadow:0 0 35px rgba(0,255,255,0.7),0 0 60px rgba(0,255,255,0.5); }
.timetable { background: linear-gradient(135deg,#36d1dc,#5b86e5); }
.studyhours { background: linear-gradient(135deg,#ff416c,#ff4b2b); }
.backlog { background: linear-gradient(135deg,#8e2de2,#4a00e0); }
.healthreport { background: linear-gradient(135deg,#00bfff,#0072ff); }
.pomodoro { background: linear-gradient(135deg,#ffb347,#ffcc33); }
.focusMode { background: linear-gradient(135deg,#ffa69e,#861657); }

.widget-container { display:flex; justify-content:center; gap:30px; margin-top:60px; flex-wrap:wrap; }
.widget { background: rgba(255,255,255,0.1); backdrop-filter:blur(10px); width:220px; padding:20px; border-radius:20px; text-align:center; box-shadow:0 0 25px rgba(0,0,0,0.5); transition: transform 0.3s, box-shadow 0.3s; cursor: default; position:relative; }
.widget:hover { transform:translateY(-5px) scale(1.02); box-shadow:0 0 35px rgba(0,255,255,0.7),0 0 60px rgba(0,255,255,0.5); }
.widget h3 { margin-top:0; margin-bottom:10px; font-size:1.2rem; border-bottom:1px solid rgba(255,255,255,0.3); padding-bottom:5px; }
.widget ul { padding-left:20px; margin:5px 0 0 0; text-align:left; max-height:220px; overflow:auto; }
.progress-bar-container { background: rgba(255,255,255,0.3); border-radius:10px; height:20px; width:100%; margin-top:10px; }
.progress-bar { height:100%; width:0%; background:linear-gradient(135deg,#00ff88,#00bfff); border-radius:10px; transition: width 0.5s ease; }
#progressText { color:#00ff88; font-weight:bold; margin-top:5px; }

#fullWeekModal {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%) scale(0.95);
  width: 60vw;
  max-width: 1100px;
  height: 70vh;
  background: rgba(10,10,10,0.95);
  border-radius: 14px;
  padding: 20px;
  z-index: 9999;
  box-shadow: 0 10px 40px rgba(0,0,0,0.7);
  display: none;
  flex-direction: column;
  overflow: hidden;
  transition: transform 220ms ease, opacity 220ms ease;
}
#fullWeekModal.open { display:flex; transform: translate(-50%, -50%) scale(1); }
#fullWeekBackdrop {
  position: fixed;
  left:0; top:0; right:0; bottom:0;
  background: rgba(0,0,0,0.45);
  display: none;
  z-index: 9998;
}
#fullWeekBackdrop.open { display:block; }

.weekTable { width:100%; border-collapse:collapse; color:#fff; }
.weekTable th, .weekTable td { border: 1px solid rgba(255,255,255,0.08); padding:8px 10px; text-align:left; min-width:120px; }
.weekTable th { background: rgba(255,255,255,0.04); position: sticky; top:0; }
</style>
</head>
<body>
<h1>Welcome to Your Study Planner</h1>

<div class="button-container">
  <div class="tile timetable" onclick="location.href='timetable.html'">
    üìÖ <br><i class="fas fa-calendar-alt"></i> <br> Timetable
  </div>
  <div class="tile studyhours" onclick="location.href='studyhours.html'">
    üìò <br><i class="fas fa-book"></i> <br> Study Hours
  </div>
  <div class="tile backlog" onclick="location.href='notes.html'">
    üßæ <br><i class="fas fa-sticky-note"></i> <br> Backlog
  </div>
  <div class="tile healthreport" onclick="location.href='about.html'">
    ‚ù§Ô∏è <br><i class="fas fa-heartbeat"></i> <br> Health Report
  </div>
  <div class="tile pomodoro" onclick="location.href='pomodoro.html'">
    ‚è±Ô∏è <br><i class="fas fa-stopwatch"></i> <br> Pomodoro Timer
  </div>
  <div class="tile focusMode" onclick="location.href='focus.html'">
    üåø <br><i class="fas fa-spa"></i> <br> Focus
  </div>
</div>

<div class="widget-container">
  <div class="widget" id="todaySchedule">
    <h3>Today's Schedule</h3>
    <ul id="scheduleList"></ul>
  </div>
  <div class="widget" id="upcomingDeadline">
    <h3>Upcoming Backlog Completion</h3>
    <p><strong>Science:</strong> <span id="nextScience"></span></p>
    <p><strong>Maths:</strong> <span id="nextMaths"></span></p>
    <p><strong>Social Science:</strong> <span id="nextSSC"></span></p>
  </div>
  <div class="widget" id="studyProgress">
    <h3>Backlog Completion Progress</h3>
    <div class="progress-bar-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <p id="progressText">0%</p>
  </div>
  <div class="widget fullWeekWidget" id="fullWeekWidget">
    <h3>üìÖ Full Week Timetable</h3>
    <p style="margin:6px 0 0 0; font-size:0.95rem;">Click to expand</p>
  </div>
</div>

<div id="fullWeekBackdrop"></div>
<div id="fullWeekModal">
  <div class="modalHeader">
    <h3>Full Week Timetable</h3>
    <button id="closeFullWeek" style="background:none;border:none;color:#fff;font-size:1.3rem;cursor:pointer;">‚úï</button>
  </div>
  <div class="modalBody" id="fullWeekBody"></div>
</div>

<script>
// --- Launcher Logic: Intro -> Login -> Welcome -> Dashboard ---
const urlParams = new URLSearchParams(window.location.search);
if (!sessionStorage.getItem('introSeen') && !urlParams.has('onboarded')) {
  sessionStorage.setItem('introSeen', 'true');
  window.location.href = 'intro.html';
}

// --- Service Worker Registration ---
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js')
    .then(() => console.log("Service Worker Registered"))
    .catch(err => console.log("Service Worker Failed", err));
}

// --- Timetable Logic ---
function parseStoredTimetable(key) {
  const raw = localStorage.getItem(key);
  if (!raw) return null;
  try {
    const data = JSON.parse(raw);
    if (Array.isArray(data)) return { type: 'table-rows', data };
    return { type: 'object', data };
  } catch (e) { return null; }
}

function loadTodaySchedule() {
  const scheduleList = document.getElementById('scheduleList');
  const now = new Date();
  const day = now.getDay();
  if (day >= 1 && day <= 5) {
    const parsed = parseStoredTimetable('timetable_weekdays');
    if (parsed && parsed.type === 'table-rows') {
      const rows = parsed.data;
      const dayNames = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
      let colIndex = rows[0].findIndex(h => h.trim() === dayNames[day]);
      let any = false;
      for (let i = 1; i < rows.length; i++) {
        if (rows[i][colIndex]) {
          any = true;
          const li = document.createElement('li');
          li.textContent = rows[i][0] + ': ' + rows[i][colIndex];
          scheduleList.appendChild(li);
        }
      }
      if (!any) scheduleList.innerHTML = '<li>Free day!</li>';
    }
  }
}

// Progress and Deadlines
function getNextBacklog(subject) {
  const arr = JSON.parse(localStorage.getItem(subject+'BacklogData')) || [];
  return arr.find(row => String(row[1]).toLowerCase() !== 'yes');
}

function updateUI() {
  document.getElementById('nextScience').textContent = getNextBacklog('science')?.[0] || 'Done!';
  document.getElementById('nextMaths').textContent = getNextBacklog('maths')?.[0] || 'Done!';
  document.getElementById('nextSSC').textContent = getNextBacklog('ssc')?.[0] || 'Done!';
  
  const subjects = ['science','maths','ssc'];
  let comp = 0, tot = 0;
  subjects.forEach(s => {
    const data = JSON.parse(localStorage.getItem(s+'BacklogData')) || [];
    data.forEach(r => { tot++; if(String(r[1]).toLowerCase()==='yes') comp++; });
  });
  const p = tot === 0 ? 0 : Math.round((comp/tot)*100);
  document.getElementById('progressBar').style.width = p + '%';
  document.getElementById('progressText').textContent = p + '%';
}

window.addEventListener('load', () => {
  loadTodaySchedule();
  updateUI();
  document.getElementById('fullWeekWidget').onclick = () => {
    document.getElementById('fullWeekModal').classList.add('open');
    document.getElementById('fullWeekBackdrop').classList.add('open');
  };
  document.getElementById('closeFullWeek').onclick = () => {
    document.getElementById('fullWeekModal').classList.remove('open');
    document.getElementById('fullWeekBackdrop').classList.remove('open');
  };
});
</script>
</body>
</html>
